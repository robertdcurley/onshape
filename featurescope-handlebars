FeatureScript 2878;
import(path : "onshape/std/geometry.fs", version : "2878.0");

annotation { "Feature Type Name" : "Handlebar Start" }
export const handlebarStart = defineFeature(function(context is Context, id is Id, definition is map)
    precondition {}
    {
        // 1. Evaluate the Top plane using the standard ID
        var facePlane = evPlane(context, {
                "face" : qCreatedBy(makeId("Top"), EntityType.FACE)
        });

        // 2. Initialize a single sketch
        var sketch1 = newSketchOnPlane(context, id + "sketch1", {
                "sketchPlane" : facePlane
        });

        // 3. Draw the straight line from origin to x = -140
        skLineSegment(sketch1, "line1", {
                "start" : vector(0, 0) * millimeter,
                "end"   : vector(-140, 0) * millimeter
        });

        // 4. Draw the arc starting where the line ends
        // Center at (-140, 40), radius 40. 
        // 1. Define your parameters
        var radius = 40 * millimeter;
        var startPoint = vector(-140, 0) * millimeter;

        // 2. Calculate coordinates relative to the center
        // For a 90° arc starting at (-140,0) and going left/up:
        // The center must be at (-140, radius)
        var center = vector(-140 * millimeter, radius);
        var endPoint = vector(-140 * millimeter - radius, radius);

        // 3. Calculate the midpoint (at the 45° mark)
        // Using sin(45°) and cos(45°) which is approx 0.7071
        var midPoint = center + vector(-radius * 0.7071, -radius * 0.7071);

        // 4. Draw the arc
        skArc(sketch1, "arc1", {
            "start" : startPoint,
            "mid"   : midPoint,
            "end"   : endPoint
        });
        // 5. Draw the straight segment to the start of the next arc
        skLineSegment(sketch1, "line2", {
            "start" : endPoint,
            "end"   : endPoint + vector(0, 35) * millimeter
        });


        // 6. Finalize the sketch
        skSolve(sketch1);
        

        // 8. Define the plane looking down the +X axis (Standard Right View)
        // Normal (1, 0, 0) + X-axis (0, 1, 0) = Sketch Y is Global +Z (UP)
        var posXP_plane = plane(
        vector(-180, 0, 0) * millimeter, 
        vector(1, 0, 0),                 // Change this from -1 to 1
        vector(0, 1, 0)                  
        );



        // 9. Initialize the sketch on the offset plane
        var sketch2 = newSketchOnPlane(context, id + "sketch2", {
                "sketchPlane" : posXP_plane
        });

 
        var radius1 = 40 * millimeter;
        var startPoint1 = vector(75, 0) * millimeter; // Top of the drop
        var center1 = vector(75, -40) * millimeter;  // 40mm directly below start
        var endPoint1 = vector(115, -40) * millimeter; // 40mm to the right of center

        // FORCE 2D VECTORS: Ensure no 'Z' component is present
        // To make the arc curve OUT (Right) and DOWN:
        // The midpoint should be at the 45° mark between 12 o'clock and 3 o'clock
        // Relative to center: x = +R*sin(45), y = +R*cos(45)
        var midPoint1 = center1 + vector(radius1 * 0.7071, radius1 * 0.7071);

        skArc(sketch2, "arc2", {
            "start" : startPoint1,
            "mid"   : midPoint1,
            "end"   : endPoint1
        });
        //  Finalize the sketch
        // skSolve(sketch2);
        
        var radius2 = 90 * millimeter;
        var startPoint2 = vector(115, -40) * millimeter; // Top of the drop
        var center2 = vector(25, -40) * millimeter;  // 25mm directly below start
        var endPoint2 = vector(25, -130) * millimeter; // 25mm to the right of center

        // FORCE 2D VECTORS: Ensure no 'Z' component is present
        // To make the arc curve OUT (Right) and DOWN:
        // The midpoint should be at the 45° mark between 12 o'clock and 3 o'clock
        // Relative to center: x = +R*sin(45), y = +R*cos(45)
        var midPoint2 = center2 + vector(radius2 * 0.7071, -radius2 * 0.7071);

        skArc(sketch2, "arc3", {
            "start" : startPoint2,
            "mid"   : midPoint2,
            "end"   : endPoint2
        });
        
        //. Draw the straight line from origin to x = -140
        skLineSegment(sketch2, "line3", {
                "start" : vector(25, -130) * millimeter,
                "end"   : vector(-65, -130) * millimeter
        });
        
        // Define the 3D coordinate
        var myPointLocation = vector(-180,-65,-130) * millimeter;

        // Create the point
        opPoint(context, id + "point1", {
            "point" : myPointLocation
        });

        // Create the Plane object with an explicit Origin and Normal
        // plane(origin, normal, xDirection)
        var parallelToFront = plane(
        myPointLocation,  // This sets the visual center
        vector(0, 1, 0),  // Normal to Y (Parallel to Front)
        vector(1, 0, 0)   // X-axis of the plane points along Global X
        );

        // Execute the operation
        opPlane(context, id + "myPlane1", {
        "plane" : parallelToFront,
        "width" : 50 * millimeter,  // Optional: Forces a specific visual size
        "height" : 50 * millimeter  // Optional: Forces a specific visual size
});

        
        //  Finalize the sketch
        
        skSolve(sketch2);

    });
